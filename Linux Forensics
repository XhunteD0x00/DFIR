the two most common entry points for an external attacker are either through public-facing servers or through endpoints used by individuals

it is useful to know how to find forensic information on a Linux machine

Some of the common Linux distributions include:

    Ubuntu
    Redhat
    ArchLinux
    Open SUSE
    Linux Mint
    CentOS
    Debian

    For the purpose of this room, we will be working on the Ubuntu distribution

we will start by identifying the system and finding basic information about the system. In the case of Windows,
we identified that the Windows Registry contains information about the Windows machine. For a Linux system, everything is stored in a file

In the above command, we can see the information for the user ubuntu.
The username is ubuntu, its password information field shows x,
which signifies that the password information is stored in the /etc/shadow file.
The uid of the user is 1000.
The gid is also 1000. The description,
which often contains the full name or contact information,
mentions the name Ubuntu. The home directory is set to /home/ubuntu, and the default shell is set to /bin/bash

A Linux host allows only those users to elevate privileges to sudo, which are present in the Sudoers list. This list is stored in the file /etc/sudoers 

In the /var/log directory, we can find log files of all kinds including wtmp and btmp
-The "btmp file" saves information about failed logins
-the wtmp keeps historical data of logins. 
These files are not regular text files that can be read using cat, less or vim; instead, they are binary files, which have to be read using the last utility ---> note

Every user that authenticates on a Linux host is logged in the auth log. 

Once we have identified the OS and account information, we can start looking into the system configuration of the host.

Timezone information is a significant piece of information that gives an indicator of the general location of the device or 
To find information about the network interfaces, we can cat the /etc/network/interfaces 

Similarly, to find information about the MAC and IP addresses of the different interfaces, we can use the ip utility. To learn more about the ip utility, we can see its man page.

Active network connections :On a live system, knowing the active network connections provides additional context to the investigation. We can use the netstat utility to find active network connections on a Linux host


Running processes

If performing forensics on a live system, it is helpful to check the running processes

DNS information

The file /etc/hosts contains the configuration for the DNS name assignment

The information about DNS servers that a Linux host talks to for DNS resolution is stored in the resolv.conf file.
Its location is /etc/resolv.conf. We can use the cat utility to read this file. 


Knowing the environment we are investigating, we can then move on to finding out what persistence mechanisms exist on the Linux host under investigation.
Persistence mechanisms are ways a program can survive after a system reboot.
This helps malware authors retain their access to a system even if the system is rebooted.
Let's see how we can identify persistence mechanisms in a Linux host.


Cron jobs are commands that run periodically after a set amount of time. A Linux host maintains a list of Cron jobs in a file located at /etc/crontab

the file contains information about the time interval after which the command has to run, the username that runs the command, and the command itself.
It can also contain scripts to run, where the script that needs to be run will be placed on the disk, and the command to run it will be added to this file.

Like Windows, services can be set up in Linux that will start and run in the background after every system boot.
A list of services can be found in the /etc/init.d directory. We can check the contents of the directory by using the ls utility.


When a bash shell is spawned, it runs the commands stored in the .bashrc file.
This file can be considered as a startup list of actions to be performed. Hence it can prove to be a good place to look for persistence. 


Knowing what programs have been executed on a host is one of the main purposes of performing forensic analysis.
On a Linux host, we can find the evidence of execution from the following sources.
All the commands that are run on a Linux host using sudo are stored in the auth log. 


Any commands other than the ones run using sudo are stored in the bash history.
Every user's bash history is stored separately in that user's home folder.
Therefore, when examining bash history, we need to get the bash_history file from each user's home directory.
It is important to examine the bash history from the root user as well, to make note of all the commands run using the root user as well.


The Vim text editor stores logs for opened files in Vim in the file named .viminfo in the home directory.
This file contains command line history, search string history, etc. for the opened files. We can use the cat utility to open .viminfo.


One of the most important sources of information on the activity on a Linux host is the log files.
These log files maintain a history of activity performed on the host and the amount of logging depends on the logging level defined on the system.
Let's take a look at some of the important log sources. Logs are generally found in the /var/log directory.

The Syslog contains messages that are recorded by the host about system activity.
The detail which is recorded in these messages is configurable through the logging level.
We can use the cat utility to view the Syslog, which can be found in the file /var/log/syslog.
Since the Syslog is a huge file, it is easier to use tail, head, more or less utilities to help make it more readable.
shows the system time, system name, the process that sent the log [the process id],
and the details of the log. We can see a couple of cron jobs being run here in the logs above, apart from some other activity.
We can see an asterisk(*) after the syslog.
This is to include rotated logs as well. With the passage of time, the Linux machine rotates older logs into files such as syslog.1, syslog.2 etc, so that the syslog file doesn't become too big.
In order to search through all of the syslogs, we use the asterisk(*) wildcard.


We have already discussed the auth logs in the previous tasks. The auth logs contain information about users and authentication-related logs
Similar to the syslog and authentication logs, the /var/log/ directory contains logs for 
third-party applications such as 1-webserver, 2-database,3- or file share server logs. 
We can investigate these by looking at the /var/log/ directory. 



Artifacts:

1-OS release information:  cat /etc/os-release 
2-User accounts : cat /etc/passwd| column -t -s :
3-The password information : cat /etc/shadow
4-Group Information : cat /etc/group    file contains information about the different user groups present on the host
5-Sudoers List : sudo cat /etc/sudoers
6-Login information : sudo last -f /var/log/wtmp
7-Authentication logs : cat /var/log/auth.log |tail
8-Hostname : cat /etc/hostname 
9-Timezone : cat /etc/timezone
10-Network Configuration : cat /etc/network/interfaces 
11-the MAC and IP addresses  : ip address show 
12-Active network connections : netstat -natp
13-Running processes : ps aux
14-DNS information : cat /etc/hosts
15-DNS servers that a Linux host talks to for DNS resolution : cat /etc/resolv.conf 
16-Cron jobs : cat /etc/crontab 
17-Service startup : ls /etc/init.d/
18-.Bashrc : cat ~/.bashrc
System-wide settings are stored in /etc/bash.bashrc and /etc/profile files, so it is often a good idea to take a look at these files as well.
19-Sudo execution history :  cat /var/log/auth.log* |grep -i COMMAND|tail
20-Bash history : cat ~/.bash_history 
21-Files accessed using vim :  cat ~/.viminfo
22-Syslog : cat /var/log/syslog* | head
23-Auth logs : cat /var/log/auth.log* |head
24-Third-party logs : ls /var/log





Test : 
1- In the bashrc file, the size of the history file is defined. What is the size of the history file that is set for the user Ubuntu in the attached machine? 
look at  cat ~/.bashrc
# append to the history file, don't overwrite it
shopt -s histappend
# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=1000
HISTFILESIZE=2000

2-The user tryhackme used apt-get to install a package. What was the command that was issued?  sudo cat .bash_history in the home of the user

3-What was the current working directory when the command to install net-tools was issued? cat /var/log/auth.log* |grep net-tools 

4-Though the machine's current hostname is the one we identified in Task 4. The machine earlier had a different hostname. What was the previous hostname of the machine?
use at /var/log/syslog* | grep -i hostname     علشان فيه كل التغيرات اللي حصلت في السيسيتم
look at change from "the Answer"







